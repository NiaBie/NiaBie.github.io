<!-- 通用模板 -->

<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <!-- jquery -->
  <script src="https://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>

  
<link rel="stylesheet" href="/css/main.css">

<meta name="generator" content="Hexo 5.0.0"></head>

<body onload="my_load()"">

  <div class="web_name_box">
    
  </div>
  
  <!-- 顶部菜单栏 -->

<div class="menu_box shadow_box">
  <div class="menu_item_box left" id="menu_preview">preview</div>
  <div class="menu_item_box left" id="menu_tags">tags</div>
  <div class="menu_item_box left" id="menu_categories">categories</div>

  <div class="search_input_box left" id="search_input_box">
    <input type="search" placeholder="" id="search_input" class="search_input">
  </div>

  <div class="menu_item_box right" id="menu_next">next</div>
  
    <div class="menu_item_box right" id="menu_guide">guide</div>
  
  <div class="menu_item_box right" id="menu_site">sites</div>
</div>

<div class="tag_box shadow_box" id="tag_box"></div>

<div class="category_box shadow_box" id="category_box"></div>

<div class="site_box shadow_box" id="site_box">
  <span class="site_item">
    <a href="/">home</a>
  </span>
  <span class="site_item">
    <a href="/archives">archives</a>
  </span>
  <span class="site_item">
    <a target="_blank" rel="noopener" href="https://github.com/NiaBie">github</a>
  </span>
  <span class="site_item">
    <a href="/knife">knives</a>
  </span>
  <span class="site_item">
    <a href="/friends">links</a>
  </span>
</div>


  <!-- 附加导航 -->
  <div class="guide_box shadow_box" id="guide_box">
    <div class="tag_list_box" id="tag_list_box">
      <span class="guide_item">tags</span>
      
        
          <span class="tag_item">
            <a href="/tags/javascript/">javascript</a>
          </span>
        
          <span class="tag_item">
            <a href="/tags/live2d/">live2d</a>
          </span>
        
          <span class="tag_item">
            <a href="/tags/html/">html</a>
          </span>
        
      
    </div>

    <div class="line_box" id="guide_line_box"></div>
    <style>
      #guide_line_box {
        width: 90%;
      }
    </style>
    
    <div class="category_list_box" id="category_list_box">
      <span class="guide_item">categories</span>
      
        
      
    </div>

    <div class="guide_list_box border_box" id="guide_list_box"></div>
  </div>


<div class="search_result_box shadow_box" id="search_result_box">
  <div id="search_filter" class="search_list_box">
    <span id="search_filter_1" class="search_item">
      <a>only title</a>
    </span>
    <span id="search_filter_2" class="search_item">
      <a>title and content</a>
    </span>
  </div>
  <div id="search_result_list" class="search_result_list"></div>
</div>



<script>
  tags_name = new Array();
  tags_path = new Array();

  ''
    var temp = 'sage';
    tags_name.push(temp);
    temp = 'tags/sage/';
    tags_path.push(temp);
  ''
    var temp = 'python';
    tags_name.push(temp);
    temp = 'tags/python/';
    tags_path.push(temp);
  ''
    var temp = 'android studio';
    tags_name.push(temp);
    temp = 'tags/android-studio/';
    tags_path.push(temp);
  ''
    var temp = 'android';
    tags_name.push(temp);
    temp = 'tags/android/';
    tags_path.push(temp);
  ''
    var temp = 'adb';
    tags_name.push(temp);
    temp = 'tags/adb/';
    tags_path.push(temp);
  ''
    var temp = 'java';
    tags_name.push(temp);
    temp = 'tags/java/';
    tags_path.push(temp);
  ''
    var temp = 'cubism';
    tags_name.push(temp);
    temp = 'tags/cubism/';
    tags_path.push(temp);
  ''
    var temp = 'javascript';
    tags_name.push(temp);
    temp = 'tags/javascript/';
    tags_path.push(temp);
  ''
    var temp = 'live2d';
    tags_name.push(temp);
    temp = 'tags/live2d/';
    tags_path.push(temp);
  ''
    var temp = 'typescript';
    tags_name.push(temp);
    temp = 'tags/typescript/';
    tags_path.push(temp);
  ''
    var temp = 'npm';
    tags_name.push(temp);
    temp = 'tags/npm/';
    tags_path.push(temp);
  ''
    var temp = 'linux';
    tags_name.push(temp);
    temp = 'tags/linux/';
    tags_path.push(temp);
  ''
    var temp = 'powerline';
    tags_name.push(temp);
    temp = 'tags/powerline/';
    tags_path.push(temp);
  ''
    var temp = 'zsh';
    tags_name.push(temp);
    temp = 'tags/zsh/';
    tags_path.push(temp);
  ''
    var temp = 'vim';
    tags_name.push(temp);
    temp = 'tags/vim/';
    tags_path.push(temp);
  ''
    var temp = 'git';
    tags_name.push(temp);
    temp = 'tags/git/';
    tags_path.push(temp);
  ''
    var temp = 'pip';
    tags_name.push(temp);
    temp = 'tags/pip/';
    tags_path.push(temp);
  ''
    var temp = 'gnome';
    tags_name.push(temp);
    temp = 'tags/gnome/';
    tags_path.push(temp);
  ''
    var temp = 'c';
    tags_name.push(temp);
    temp = 'tags/c/';
    tags_path.push(temp);
  ''
    var temp = 'makefile';
    tags_name.push(temp);
    temp = 'tags/makefile/';
    tags_path.push(temp);
  ''
    var temp = 'PyQt5';
    tags_name.push(temp);
    temp = 'tags/PyQt5/';
    tags_path.push(temp);
  ''
    var temp = 'qt';
    tags_name.push(temp);
    temp = 'tags/qt/';
    tags_path.push(temp);
  ''
    var temp = 'cpp';
    tags_name.push(temp);
    temp = 'tags/cpp/';
    tags_path.push(temp);
  ''
    var temp = 'deb';
    tags_name.push(temp);
    temp = 'tags/deb/';
    tags_path.push(temp);
  ''
    var temp = 'debreate';
    tags_name.push(temp);
    temp = 'tags/debreate/';
    tags_path.push(temp);
  ''
    var temp = 'php';
    tags_name.push(temp);
    temp = 'tags/php/';
    tags_path.push(temp);
  ''
    var temp = 'apahce2';
    tags_name.push(temp);
    temp = 'tags/apahce2/';
    tags_path.push(temp);
  ''
    var temp = 'latex';
    tags_name.push(temp);
    temp = 'tags/latex/';
    tags_path.push(temp);
  ''
    var temp = 'html';
    tags_name.push(temp);
    temp = 'tags/html/';
    tags_path.push(temp);
  ''
    var temp = 'css';
    tags_name.push(temp);
    temp = 'tags/css/';
    tags_path.push(temp);
  ''
    var temp = 'bucket';
    tags_name.push(temp);
    temp = 'tags/bucket/';
    tags_path.push(temp);
  ''
    var temp = '七牛云';
    tags_name.push(temp);
    temp = 'tags/七牛云/';
    tags_path.push(temp);
  ''
    var temp = 'cdn';
    tags_name.push(temp);
    temp = 'tags/cdn/';
    tags_path.push(temp);
  ''
    var temp = 'chrome';
    tags_name.push(temp);
    temp = 'tags/chrome/';
    tags_path.push(temp);
  ''
    var temp = 'qqbrowser';
    tags_name.push(temp);
    temp = 'tags/qqbrowser/';
    tags_path.push(temp);
  ''
    var temp = 'cmake';
    tags_name.push(temp);
    temp = 'tags/cmake/';
    tags_path.push(temp);
  ''
    var temp = '正则表达式';
    tags_name.push(temp);
    temp = 'tags/正则表达式/';
    tags_path.push(temp);
  ''
    var temp = 'http';
    tags_name.push(temp);
    temp = 'tags/http/';
    tags_path.push(temp);
  ''
    var temp = 'eigen';
    tags_name.push(temp);
    temp = 'tags/eigen/';
    tags_path.push(temp);
  ''
    var temp = 'gcc';
    tags_name.push(temp);
    temp = 'tags/gcc/';
    tags_path.push(temp);
  ''
    var temp = 'assemly';
    tags_name.push(temp);
    temp = 'tags/assemly/';
    tags_path.push(temp);
  ''
    var temp = 'gdb';
    tags_name.push(temp);
    temp = 'tags/gdb/';
    tags_path.push(temp);
  ''
    var temp = 'ssh';
    tags_name.push(temp);
    temp = 'tags/ssh/';
    tags_path.push(temp);
  ''
    var temp = 'windows';
    tags_name.push(temp);
    temp = 'tags/windows/';
    tags_path.push(temp);
  ''
    var temp = 'grub';
    tags_name.push(temp);
    temp = 'tags/grub/';
    tags_path.push(temp);
  ''
    var temp = 'hexo';
    tags_name.push(temp);
    temp = 'tags/hexo/';
    tags_path.push(temp);
  ''
    var temp = 'swig';
    tags_name.push(temp);
    temp = 'tags/swig/';
    tags_path.push(temp);
  ''
    var temp = 'ejs';
    tags_name.push(temp);
    temp = 'tags/ejs/';
    tags_path.push(temp);
  ''
    var temp = 'mathjax';
    tags_name.push(temp);
    temp = 'tags/mathjax/';
    tags_path.push(temp);
  ''
    var temp = 'katex';
    tags_name.push(temp);
    temp = 'tags/katex/';
    tags_path.push(temp);
  ''
    var temp = '阿里云';
    tags_name.push(temp);
    temp = 'tags/阿里云/';
    tags_path.push(temp);
  ''
    var temp = 'shell';
    tags_name.push(temp);
    temp = 'tags/shell/';
    tags_path.push(temp);
  ''
    var temp = 'jni';
    tags_name.push(temp);
    temp = 'tags/jni/';
    tags_path.push(temp);
  ''
    var temp = 'ndk';
    tags_name.push(temp);
    temp = 'tags/ndk/';
    tags_path.push(temp);
  ''
    var temp = 'opencv';
    tags_name.push(temp);
    temp = 'tags/opencv/';
    tags_path.push(temp);
  ''
    var temp = 'jsdelivr';
    tags_name.push(temp);
    temp = 'tags/jsdelivr/';
    tags_path.push(temp);
  ''
    var temp = 'jquery';
    tags_name.push(temp);
    temp = 'tags/jquery/';
    tags_path.push(temp);
  ''
    var temp = 'krita';
    tags_name.push(temp);
    temp = 'tags/krita/';
    tags_path.push(temp);
  ''
    var temp = 'mac';
    tags_name.push(temp);
    temp = 'tags/mac/';
    tags_path.push(temp);
  ''
    var temp = 'brew';
    tags_name.push(temp);
    temp = 'tags/brew/';
    tags_path.push(temp);
  ''
    var temp = 'visual studio';
    tags_name.push(temp);
    temp = 'tags/visual-studio/';
    tags_path.push(temp);
  ''
    var temp = 'csharp';
    tags_name.push(temp);
    temp = 'tags/csharp/';
    tags_path.push(temp);
  ''
    var temp = 'mysql';
    tags_name.push(temp);
    temp = 'tags/mysql/';
    tags_path.push(temp);
  ''
    var temp = 'sql';
    tags_name.push(temp);
    temp = 'tags/sql/';
    tags_path.push(temp);
  ''
    var temp = 'unpkg';
    tags_name.push(temp);
    temp = 'tags/unpkg/';
    tags_path.push(temp);
  ''
    var temp = 'bfs';
    tags_name.push(temp);
    temp = 'tags/bfs/';
    tags_path.push(temp);
  ''
    var temp = 'dfs';
    tags_name.push(temp);
    temp = 'tags/dfs/';
    tags_path.push(temp);
  ''
    var temp = 'dijkstra算法';
    tags_name.push(temp);
    temp = 'tags/dijkstra算法/';
    tags_path.push(temp);
  ''
    var temp = 'dinic算法';
    tags_name.push(temp);
    temp = 'tags/dinic算法/';
    tags_path.push(temp);
  ''
    var temp = 'ek算法';
    tags_name.push(temp);
    temp = 'tags/ek算法/';
    tags_path.push(temp);
  ''
    var temp = 'floyd算法';
    tags_name.push(temp);
    temp = 'tags/floyd算法/';
    tags_path.push(temp);
  ''
    var temp = 'km算法';
    tags_name.push(temp);
    temp = 'tags/km算法/';
    tags_path.push(temp);
  ''
    var temp = 'kmp算法';
    tags_name.push(temp);
    temp = 'tags/kmp算法/';
    tags_path.push(temp);
  ''
    var temp = 'kruskal算法';
    tags_name.push(temp);
    temp = 'tags/kruskal算法/';
    tags_path.push(temp);
  ''
    var temp = 'morris算法';
    tags_name.push(temp);
    temp = 'tags/morris算法/';
    tags_path.push(temp);
  ''
    var temp = 'prim算法';
    tags_name.push(temp);
    temp = 'tags/prim算法/';
    tags_path.push(temp);
  ''
    var temp = 'tarjan算法';
    tags_name.push(temp);
    temp = 'tags/tarjan算法/';
    tags_path.push(temp);
  ''
    var temp = '树的遍历';
    tags_name.push(temp);
    temp = 'tags/树的遍历/';
    tags_path.push(temp);
  ''
    var temp = '匈牙利算法';
    tags_name.push(temp);
    temp = 'tags/匈牙利算法/';
    tags_path.push(temp);
  ''
    var temp = 'photoshop';
    tags_name.push(temp);
    temp = 'tags/photoshop/';
    tags_path.push(temp);
  ''
    var temp = '绘画';
    tags_name.push(temp);
    temp = 'tags/绘画/';
    tags_path.push(temp);
  ''
    var temp = 'numpy';
    tags_name.push(temp);
    temp = 'tags/numpy/';
    tags_path.push(temp);
  ''
    var temp = 'sklearn';
    tags_name.push(temp);
    temp = 'tags/sklearn/';
    tags_path.push(temp);
  ''
    var temp = 'matplotlib';
    tags_name.push(temp);
    temp = 'tags/matplotlib/';
    tags_path.push(temp);
  ''
    var temp = 'slenium';
    tags_name.push(temp);
    temp = 'tags/slenium/';
    tags_path.push(temp);
  ''
    var temp = 'phantomjs';
    tags_name.push(temp);
    temp = 'tags/phantomjs/';
    tags_path.push(temp);
  ''
    var temp = 'rss';
    tags_name.push(temp);
    temp = 'tags/rss/';
    tags_path.push(temp);
  ''
    var temp = 'xml';
    tags_name.push(temp);
    temp = 'tags/xml/';
    tags_path.push(temp);
  ''
    var temp = '爬虫';
    tags_name.push(temp);
    temp = 'tags/爬虫/';
    tags_path.push(temp);
  ''
    var temp = 'ajax';
    tags_name.push(temp);
    temp = 'tags/ajax/';
    tags_path.push(temp);
  ''
    var temp = 'termux';
    tags_name.push(temp);
    temp = 'tags/termux/';
    tags_path.push(temp);
  ''
    var temp = '内网穿透';
    tags_name.push(temp);
    temp = 'tags/内网穿透/';
    tags_path.push(temp);
  ''
    var temp = 'stitch';
    tags_name.push(temp);
    temp = 'tags/stitch/';
    tags_path.push(temp);
  ''
    var temp = 'sublime';
    tags_name.push(temp);
    temp = 'tags/sublime/';
    tags_path.push(temp);
  ''
    var temp = 'svg';
    tags_name.push(temp);
    temp = 'tags/svg/';
    tags_path.push(temp);
  ''
    var temp = 'tmux';
    tags_name.push(temp);
    temp = 'tags/tmux/';
    tags_path.push(temp);
  ''
    var temp = 'ubuntu';
    tags_name.push(temp);
    temp = 'tags/ubuntu/';
    tags_path.push(temp);
  ''
    var temp = 'wlan';
    tags_name.push(temp);
    temp = 'tags/wlan/';
    tags_path.push(temp);
  ''
    var temp = 'midi';
    tags_name.push(temp);
    temp = 'tags/midi/';
    tags_path.push(temp);
  ''
    var temp = 'lol';
    tags_name.push(temp);
    temp = 'tags/lol/';
    tags_path.push(temp);
  ''
    var temp = 'hyper';
    tags_name.push(temp);
    temp = 'tags/hyper/';
    tags_path.push(temp);
  ''
    var temp = 'vpn';
    tags_name.push(temp);
    temp = 'tags/vpn/';
    tags_path.push(temp);
  ''
    var temp = 'shadowsocks';
    tags_name.push(temp);
    temp = 'tags/shadowsocks/';
    tags_path.push(temp);
  ''
    var temp = 'ssr';
    tags_name.push(temp);
    temp = 'tags/ssr/';
    tags_path.push(temp);
  ''
    var temp = '驱动';
    tags_name.push(temp);
    temp = 'tags/驱动/';
    tags_path.push(temp);
  ''
    var temp = 'unity';
    tags_name.push(temp);
    temp = 'tags/unity/';
    tags_path.push(temp);
  ''
    var temp = 'vlfeat';
    tags_name.push(temp);
    temp = 'tags/vlfeat/';
    tags_path.push(temp);
  ''
    var temp = 'vscode';
    tags_name.push(temp);
    temp = 'tags/vscode/';
    tags_path.push(temp);
  ''
    var temp = 'vundle';
    tags_name.push(temp);
    temp = 'tags/vundle/';
    tags_path.push(temp);
  ''
    var temp = 'wegame';
    tags_name.push(temp);
    temp = 'tags/wegame/';
    tags_path.push(temp);
  ''
    var temp = 'mathematica';
    tags_name.push(temp);
    temp = 'tags/mathematica/';
    tags_path.push(temp);
  ''
    var temp = 'wordpress';
    tags_name.push(temp);
    temp = 'tags/wordpress/';
    tags_path.push(temp);
  ''
    var temp = 'apache';
    tags_name.push(temp);
    temp = 'tags/apache/';
    tags_path.push(temp);
  ''
    var temp = 'xampp';
    tags_name.push(temp);
    temp = 'tags/xampp/';
    tags_path.push(temp);
  ''
    var temp = '百度网盘';
    tags_name.push(temp);
    temp = 'tags/百度网盘/';
    tags_path.push(temp);
  ''
    var temp = 'sai';
    tags_name.push(temp);
    temp = 'tags/sai/';
    tags_path.push(temp);
  ''
    var temp = 'medibang paint';
    tags_name.push(temp);
    temp = 'tags/medibang-paint/';
    tags_path.push(temp);
  ''
    var temp = 'gradle';
    tags_name.push(temp);
    temp = 'tags/gradle/';
    tags_path.push(temp);
  ''
    var temp = 'javacv';
    tags_name.push(temp);
    temp = 'tags/javacv/';
    tags_path.push(temp);
  ''
    var temp = '微电子';
    tags_name.push(temp);
    temp = 'tags/微电子/';
    tags_path.push(temp);
  ''
  // 因为path和name只有前缀不同,所以分别排序之后相对顺序还是一样的
  tags_name.sort();
  tags_path.sort();
  for (var i = 0; i < tags_name.length; i ++)
  {
    $("#tag_box").append("<span class='tag_item'><a href='/" + tags_path[i] + "'>" + tags_name[i] + "</a></span>\n");
  }


  categories_name = new Array();
  categories_path = new Array();

  ''
    var temp = '问题求解';
    categories_name.push(temp);
    temp = 'categories/问题求解/';
    categories_path.push(temp);
  ''
    var temp = '操作系统';
    categories_name.push(temp);
    temp = 'categories/操作系统/';
    categories_path.push(temp);
  ''
    var temp = '微电子';
    categories_name.push(temp);
    temp = 'categories/微电子/';
    categories_path.push(temp);
  ''
    var temp = '数据库';
    categories_name.push(temp);
    temp = 'categories/数据库/';
    categories_path.push(temp);
  ''
    var temp = '数据通信';
    categories_name.push(temp);
    temp = 'categories/数据通信/';
    categories_path.push(temp);
  ''
    var temp = '数理逻辑';
    categories_name.push(temp);
    temp = 'categories/数理逻辑/';
    categories_path.push(temp);
  ''
    var temp = '概率论与数理统计';
    categories_name.push(temp);
    temp = 'categories/概率论与数理统计/';
    categories_path.push(temp);
  ''
    var temp = '计算机网络';
    categories_name.push(temp);
    temp = 'categories/计算机网络/';
    categories_path.push(temp);
  ''
  // 因为path和name只有前缀不同,所以分别排序之后相对顺序还是一样的
  categories_name.sort();
  categories_path.sort();
  for (var i = 0; i < categories_name.length; i ++)
  {
    $("#category_box").append("<span class='category_item'><a href='/" + categories_path[i] + "'>" + categories_name[i] + "</a></span>\n");
  }
</script>

<script>
  // TODO 搜索
</script>
  <!-- latex公式渲染 -->



<script>
  document.temp_latex = '1';// 全局变量,latex公式渲染方式
</script>


<!-- mathjax -->
<script type="text/x-mathjax-config">
  console.log("mathjax rendering");
  
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [
        ['$','$']
      ],
      displayMath: [
        ['$$', '$$']
      ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {  
      noUndefined: { 
        attributes: { 
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "10%"
        } 
      }
    }
  });

  MathJax.Hub.Queue(["Typeset", MathJax.Hub])
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/hexo-simple-theme/hexo_latex@1.0.4/mathjax/MathJax.js?config=TeX-AMS_HTML-full"></script>
<script>
  console.log("mathjax rendering");
</script>


  <!-- 文章 -->

<div class="main_box border_box">
  <span class="post_title" id="post_title">live2d SDK WebGL 功能扩展</span>
  <br>
  <span class="post_date">2019-04-15</span>
  
  <div class="line_box" id="post_line_box"></div>
  <style>
    #post_line_box {
      width: 100%;
      margin-top: 10px;
    }
  </style>

  <blockquote>
<p>本文使用的SDK是<code>Live2D SDK WebGl 2.1</code>的<code>SampleApp1</code></p>
</blockquote>
<h2 id="1-添加模型"><a href="#1-添加模型" class="headerlink" title="1 添加模型"></a>1 添加模型</h2><ul>
<li>在<code>LAppDefine.js</code>中增加路径</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">MODEL_$&#123;NAME&#125; : <span class="string">&quot;assets/live2d/$&#123;name&#125;/$&#123;name&#125;.model.json&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>LAppLive2DManager.js</code>中修改<code>changeModel</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> (no)</span><br><span class="line">&#123;</span><br><span class="line">  ...;</span><br><span class="line">  <span class="keyword">case</span> num:</span><br><span class="line">    <span class="built_in">this</span>.releaseModel(<span class="number">1</span>, gl); <span class="comment">// 释放之前的模型</span></span><br><span class="line">    <span class="built_in">this</span>.releaseModel(<span class="number">0</span>, gl); <span class="comment">// 释放之前的模型</span></span><br><span class="line">    <span class="comment">// 如果之前加载的模型不止一个,注意要从后往前释放,否则下一个模型会卡死</span></span><br><span class="line">    <span class="comment">// 释放数量没有规定</span></span><br><span class="line">    <span class="built_in">this</span>.createModel(); <span class="comment">// 创建模型</span></span><br><span class="line">    <span class="built_in">this</span>.models[<span class="number">0</span>].load(gl, LAppDefine.$&#123;MODEL_NAME_1&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123; <span class="comment">// 加载多个模型</span></span><br><span class="line">      thisRef.createModel();</span><br><span class="line">      thisRef.models[<span class="number">1</span>].load(gl, LAppDefine.$&#123;MODEL_NAME_2&#125;);<span class="comment">// 也可以继续嵌套</span></span><br><span class="line">      <span class="comment">// (貌似嵌套的成功率要高些)</span></span><br><span class="line">      thisRef.createModel();</span><br><span class="line">      thisRef.models[<span class="number">2</span>].load(gl, LAppDefine.$&#123;MODEL_NAME_2&#125;);</span><br><span class="line">    &#125; <span class="comment">// 注意要按顺序create,否则会在当前模型卡死</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">/* this.models[0].load(gl, LAppDefine.$&#123;MODEL_NAME&#125;); // 加载单个模型 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>为防止重合,可以创建多个<code>$&#123;name&#125;.model.json</code>:</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;layout&quot;</span>:</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;center_x&quot;</span>: <span class="number">0.5</span>,</span><br><span class="line">    <span class="attr">&quot;y&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;width&quot;</span>: <span class="number">1.9</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>一般显示</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">script error</span><br><span class="line">line 0</span><br></pre></td></tr></table></figure>

<p>是<code>json</code>文件有语法错误</p>
<h3 id="重构-自动切换模型"><a href="#重构-自动切换模型" class="headerlink" title="(重构)自动切换模型"></a>(重构)自动切换模型</h3><p><code>LAppLive2DManager.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">LAppLive2DManager.prototype.changeModel = <span class="function"><span class="keyword">function</span>(<span class="params">gl</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;--&gt; LAppLive2DManager.update(gl)// (changeModel)&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> tempNum = <span class="built_in">this</span>.num;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.reloadFlg)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.reloadFlg = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> last_no = <span class="built_in">parseInt</span>((<span class="built_in">this</span>.count + LAppDefine[tempNum].MODELS.length - <span class="number">1</span>) % LAppDefine[tempNum].MODELS.length);</span><br><span class="line">    <span class="keyword">var</span> cur_no = <span class="built_in">parseInt</span>(<span class="built_in">this</span>.count % LAppDefine[tempNum].MODELS.length);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(LAppDefine[tempNum].MODELS[last_no]))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = LAppDefine[tempNum].MODELS[last_no].length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">this</span>.releaseModel(i, gl);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">this</span>.releaseModel(<span class="number">0</span>, gl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(LAppDefine[tempNum].MODELS[cur_no]))</span><br><span class="line">    &#123;</span><br><span class="line">      thisRef = <span class="built_in">this</span>;</span><br><span class="line">      <span class="built_in">this</span>.createModel();</span><br><span class="line">      <span class="built_in">this</span>.models[<span class="number">0</span>].load(gl, LAppDefine[tempNum].MODELS[cur_no][<span class="number">0</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; LAppDefine[tempNum].MODELS[cur_no].length; i ++)</span><br><span class="line">          &#123;</span><br><span class="line">          thisRef.createModel();</span><br><span class="line">          thisRef.models[i].load(gl, LAppDefine[tempNum].MODELS[cur_no][i]);</span><br><span class="line">          &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">this</span>.createModel();</span><br><span class="line">      <span class="built_in">this</span>.models[<span class="number">0</span>].load(gl, LAppDefine[tempNum].MODELS[cur_no]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LAppDefine.js</code>(其余见下文<code>多重canvas</code>),<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2012/07/three_ways_to_define_a_javascript_class.html">参考:类的声明</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myDefine = </span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">    width: <span class="number">200</span>,</span><br><span class="line">  height: <span class="number">300</span>,</span><br><span class="line"></span><br><span class="line">  VIEW_MAX_SCALE: <span class="number">1.1</span>, <span class="comment">// 不想用这个功能</span></span><br><span class="line">  VIEW_MIN_SCALE: <span class="number">0.5</span>,</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  MODELS : <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  MOTION_GROUP_IDLE : <span class="string">&quot;idle&quot;</span>, <span class="comment">// 无操作</span></span><br><span class="line">  MOTION_GROUP_TAP_BODY : <span class="string">&quot;tap_body&quot;</span>, <span class="comment">// 点击身体</span></span><br><span class="line">  MOTION_GROUP_FLICK_HEAD : <span class="string">&quot;flick_head&quot;</span>, </span><br><span class="line">  MOTION_GROUP_PINCH_IN : <span class="string">&quot;pinch_in&quot;</span>, <span class="comment">// 放大至1.5</span></span><br><span class="line">  MOTION_GROUP_PINCH_OUT : <span class="string">&quot;pinch_out&quot;</span>,  <span class="comment">// 缩小至0.5</span></span><br><span class="line">  MOTION_GROUP_SHAKE : <span class="string">&quot;shake&quot;</span>, </span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> LAppDefine = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = minNum; i &lt;= maxNum; i ++)</span><br><span class="line">  &#123;</span><br><span class="line">  LAppDefine[i] = <span class="built_in">Object</span>.create(myDefine);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  LAppDefine[<span class="number">1</span>].MODELS = [</span><br><span class="line">  <span class="string">&quot;assets/haru/haru_01.model.json&quot;</span>,</span><br><span class="line">  <span class="string">&quot;assets/haru/haru_02.model.json&quot;</span>,</span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  LAppDefine[<span class="number">0</span>].MODELS = [ <span class="comment">// 注意数组声明方式</span></span><br><span class="line">  <span class="string">&quot;assets/Epsilon/Epsilon.model.json&quot;</span>,</span><br><span class="line">  <span class="string">&quot;assets/Epsilon2.1/Epsilon2.1.model.json&quot;</span>,</span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  LAppDefine[<span class="number">2</span>].MODELS = [</span><br><span class="line">  <span class="string">&quot;assets/haru/haru.model.json&quot;</span>,</span><br><span class="line">  ];</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>

<ul>
<li>TODO<ul>
<li>2个模型是极限了,加载更多的会有bug</li>
</ul>
</li>
</ul>
<h2 id="2-模型点击事件的实现"><a href="#2-模型点击事件的实现" class="headerlink" title="2 模型点击事件的实现"></a>2 模型点击事件的实现</h2><p>官方SDK只提供了2种点击事件:触摸<code>head</code>(<code>hit_areas: name</code>)触发表情随机,触摸<code>body</code>触发<code>tap_body</code>.若要额外增加事件(触摸特定部位触发<code>motion</code>,<code>sound</code>等),在<code>&#123;name&#125;.model.json</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;hit_areas&quot;:</span><br><span class="line">[</span><br><span class="line">  &#123;&quot;name&quot;:&quot;shit&quot;, &quot;id&quot;:&quot;D_REF.BODY&quot;&#125;</span><br><span class="line">],</span><br><span class="line">&quot;motions&quot;:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tap_shit&quot;:</span><br><span class="line">  [</span><br><span class="line">    &#123;&quot;file&quot;:&quot;motions&#x2F;$&#123;&#125;.mtn&quot;,&quot;fade_in&quot;:2000, &quot;fade_out&quot;:2000&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>其中<code>hit_areas: name</code>名字随意,但是之后需要在<code>LAppDefine.js</code>中定义一个变量与之对应</li>
<li><code>hit_areas: id</code>必须要和<code>cmox</code>/<code>moc</code>中部位的<code>id</code>对应.获取<code>id</code>的方法<ul>
<li>如果有源模型<code>cmox</code>:直接在<code>cubism</code>中的<code>Parts</code>窗口里面,打开某个元素的<code>Drawable Object</code>,显示例如<code>D_REF.BODY</code>之类的<code>id</code></li>
<li>只有<code>moc</code>:在<code>Viewer</code>中打开<code>&#123;name&#125;.model.json</code>,在下拉菜单中选择<code>Model Info</code>,打开某个元素的文件夹,打开<code>draw</code>文件夹,显示如<code>D_REF.BODY</code>的<code>id</code></li>
</ul>
</li>
</ul>
<p>修改了<code>&#123;name&#125;.model.json</code>后在<code>LAppDefine</code>中增加</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">MOTION_GROUP_TAP_SHIT : <span class="string">&quot;tap_shit&quot;</span>, <span class="comment">// 对应json文件中&quot;motions&quot;的事件名</span></span><br><span class="line">...</span><br><span class="line">HIT_AREA_SHIT : <span class="string">&quot;shit&quot;</span>, <span class="comment">// 对应json文件中&quot;hit_areas&quot;的区域&quot;name&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>每次鼠标点击时,<code>LAppLive2DManager.prototype.tapEvent</code>会调用<code>hitTest</code></p>
</li>
<li><p><code>LAppModel.prototype.hitTest</code>会逐一判断点击位置(对比<code>name</code>,然后获得<code>id</code>),得到<code>id</code>后,调用<code>hitTestSimple</code></p>
</li>
</ul>
<blockquote>
<p><code>LAppDefine</code>中<code>MOTION_GROUP_&#123;EVENT&#125;</code>对应<code>json</code>的<code>motions</code>下子事件(如<code>idle</code>,<code>tap_body</code>等),没有在<code>LAppDefine</code>声明的情况下不能够直接用<code>&quot;&quot;</code>(这里和<code>Viewer</code>不一样),如果没有任何<code>motions</code>,<code>console</code>会提示<code>motions</code>加载错误</p>
</blockquote>
<p>最后在<code>LAppLive2DManager.prototype.tapEvent</code>中增加</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.models[i].hitTest(LAppDefine.HIT_AREA_SHIT, x, y)) <span class="comment">// 这里是你声明的区域名的名称</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">this</span>.models[i].startRandomMotion(LAppDefine.MOTION_GROUP_TAP_SHIT, <span class="comment">// 这里是你声明的动作子事件的名称</span></span><br><span class="line">                                     LAppDefine.PRIORITY_NORMAL); <span class="comment">// 应该是覆盖掉PRIORITY较小的(如idle)motion</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-模型大小及放缩"><a href="#3-模型大小及放缩" class="headerlink" title="3 模型大小及放缩"></a>3 模型大小及放缩</h2><p>放缩极限见<code>LAppDefine.js</code></p>
<p>模型的放缩<code>SampleApp1.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (e.type == <span class="string">&quot;mousewheel&quot;</span>) <span class="comment">// 鼠标滚轮事件</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* 暂时感觉这几句完全是多余的,影响使用</span></span><br><span class="line"><span class="comment">  --- if (e.clientX &lt; 0 || thisRef.canvas.clientWidth &lt; e.clientX ||</span></span><br><span class="line"><span class="comment">  ---     e.clientY &lt; 0 || thisRef.canvas.clientHeight &lt; e.clientY)</span></span><br><span class="line"><span class="comment">  --- &#123;</span></span><br><span class="line"><span class="comment">  ---   return;</span></span><br><span class="line"><span class="comment">  --- &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  +++ <span class="keyword">if</span> (e.clientX &lt; <span class="number">0</span> || e.clientY &lt; <span class="number">0</span>)</span><br><span class="line">  +++ &#123;</span><br><span class="line">  +++   <span class="keyword">return</span>;</span><br><span class="line">  +++ &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (e.wheelDelta &gt; <span class="number">0</span>) modelScaling(<span class="number">1.1</span>);<span class="comment">// 放大</span></span><br><span class="line">  <span class="keyword">else</span> modelScaling(<span class="number">0.9</span>);<span class="comment">// 缩小</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>未完待续</p>
</blockquote>
<h2 id="4-鼠标拖动"><a href="#4-鼠标拖动" class="headerlink" title="4 鼠标拖动"></a>4 鼠标拖动</h2><blockquote>
<p>把<code>#glcanvas</code>和<code>#btnChange</code>的<code>position</code>和<code>z-index</code>先作调整</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://www.runoob.com/jqueryui/example-draggable.html">菜鸟教程</a></p>
<p>将按钮和画布绑定到父元素<code>div</code>,并且限定移动范围</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#drag1</span> </span><br><span class="line">&#123;</span><br><span class="line">  position: fixed; // 相对屏幕不动</span><br><span class="line">  <span class="selector-tag">width</span>: 300<span class="selector-tag">px</span>;</span><br><span class="line">  <span class="selector-tag">height</span>: 500<span class="selector-tag">px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#glcanvas</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">150%</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: <span class="number">50%</span> <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0px</span>;</span><br><span class="line">  position: relative; // 相对父元素定位</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#btnChange</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">/* 必须要jquery支持 */</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">/* 支持拖动 */</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="javascript">  $( <span class="string">&quot;#drag1&quot;</span> ).draggable(&#123; <span class="attr">containment</span>: <span class="built_in">document</span>.body&#125;);<span class="comment">// 限制在&lt;body&gt;内拖拽</span></span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>live2d的canvas的<code>id</code>是<code>glcanvas</code></p>
<h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>没什么用处,删了</p>
<h2 id="6-全局鼠标跟随"><a href="#6-全局鼠标跟随" class="headerlink" title="6 全局鼠标跟随"></a>6 全局鼠标跟随</h2><p><code>SampleApp1.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">followPointer</span>(<span class="params">event</span>)</span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">  <span class="comment">// var rect = event.target.getBoundingClientRect(); // 没用了</span></span><br><span class="line">  <span class="keyword">var</span> the_div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;drag1&quot;</span>); <span class="comment">// 获得父元素(可拖拽的div)</span></span><br><span class="line">  <span class="comment">// 这里不要直接用btn或canvas来计算偏移,因为他们还有一个父元素div</span></span><br><span class="line">  <span class="keyword">var</span> cx = event.clientX; </span><br><span class="line">  <span class="keyword">var</span> cy = event.clientY;</span><br><span class="line">  <span class="keyword">var</span> rleft = the_div.offsetLeft; <span class="comment">// 直接计算偏移,相对原代码会有&lt;0.5%的误差</span></span><br><span class="line">  <span class="keyword">var</span> rtop = the_div.offsetTop;</span><br><span class="line">  <span class="keyword">var</span> sx = transformScreenX(cx - rleft);</span><br><span class="line">  <span class="keyword">var</span> sy = transformScreenY(cy - rtop);</span><br><span class="line">  <span class="keyword">var</span> vx = transformViewX(cx - rleft);</span><br><span class="line">  <span class="keyword">var</span> vy = transformViewY(cy - rtop);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (LAppDefine.DEBUG_MOUSE_LOG)</span><br><span class="line">    l2dLog(<span class="string">&quot;onMouseMove device( x:&quot;</span> + cx + <span class="string">&quot; y:&quot;</span> + cy + <span class="string">&quot; ) view( x:&quot;</span> + vx + <span class="string">&quot; y:&quot;</span> + vy + <span class="string">&quot;)&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if (thisRef.drag) 不要通过鼠标点击来转头</span></span><br><span class="line">  thisRef.lastMouseX = sx;</span><br><span class="line">  thisRef.lastMouseY = sy;</span><br><span class="line"></span><br><span class="line">  thisRef.dragMgr.setPoint(vx, vy); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>tansform...</code>什么的函数都是调用<code>Live2DFramework.js</code>中的函数,这里不深入研究</p>
<ul>
<li><p>TODO:在canvas外的跟随鼠标,在模型缩小后延迟增加.同时在多重canvas中还会互相影响响应时间</p>
<hr>
</li>
</ul>
<blockquote>
<p>对框架进行了重构,注意转换文件名</p>
</blockquote>
<h2 id="7-多重canvas"><a href="#7-多重canvas" class="headerlink" title="7 多重canvas"></a>7 多重canvas</h2><p>过程比较复杂,简单的说下思路,代码见<a target="_blank" rel="noopener" href="https://github.com/NiaBie/live2d_SDK_for_web">github</a></p>
<ul>
<li>将<code>sampleApp</code>这个函数作为对象声明,你要多少个canvas,数组就多大</li>
</ul>
<p><code>JSManager.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/live2d.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/LAppDefine.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/Live2DFramework.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/MatrixStack.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/ModelSettingJson.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/PlatformManager.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/LAppModel.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/LAppLive2DManager.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;script src=\&quot;new/SampleApp.js\&quot;&gt;&lt;/script&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> minTips = <span class="number">2</span>;<span class="comment">// 严格对应编号</span></span><br><span class="line"><span class="keyword">var</span> maxTips = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">var</span> thisMy = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"><span class="keyword">var</span> loadInterval = <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sampleManager</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = minTips; i &lt;= maxTips; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> tempDrag = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    tempDrag.id = <span class="string">&quot;drag_&quot;</span> + i;</span><br><span class="line">    tempDrag.className = <span class="string">&quot;drag&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> tempTip = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    tempTip.id = <span class="string">&quot;tip_&quot;</span> + i;</span><br><span class="line">    tempTip.className = <span class="string">&quot;tips&quot;</span>;</span><br><span class="line">    tempTip.setAttribute(<span class="string">&quot;style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;width: &quot;</span> + (LAppDefine[i].width + <span class="number">50</span>) + <span class="string">&quot;px;&quot;</span> + </span><br><span class="line">        <span class="string">&quot;left: &quot;</span> + (<span class="number">-25</span>) + <span class="string">&quot;px;&quot;</span> + </span><br><span class="line">        <span class="string">&quot;margin: 0px 0px &quot;</span> + (-LAppDefine[i].height / <span class="number">10</span>) + <span class="string">&quot;px 0px;&quot;</span></span><br><span class="line">        );</span><br><span class="line">    tempDrag.appendChild(tempTip);</span><br><span class="line">    <span class="keyword">var</span> tempCanvas = <span class="built_in">document</span>.createElement(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">    tempCanvas.id = <span class="string">&quot;glcanvas_&quot;</span> + i;</span><br><span class="line">    tempCanvas.className = <span class="string">&quot;glcanvas&quot;</span>;</span><br><span class="line">    tempCanvas.width = LAppDefine[i].width;</span><br><span class="line">    tempCanvas.height = LAppDefine[i].height;</span><br><span class="line">    tempDrag.appendChild(tempCanvas);</span><br><span class="line">    <span class="keyword">var</span> tempButton = <span class="built_in">document</span>.createElement(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">    tempButton.id = <span class="string">&quot;btnChange_&quot;</span> + i;</span><br><span class="line">    tempButton.className = <span class="string">&quot;active btnChange&quot;</span>;</span><br><span class="line">    tempDrag.appendChild(tempButton);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(tempDrag);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="string">&quot;new sampleApp(&quot;</span> + i + <span class="string">&quot;)&quot;</span>, (i - minTips) * loadInterval);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="string">&quot;myDrag()&quot;</span>, (maxTips - minTips + <span class="number">1</span>) * loadInterval);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myDrag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $(<span class="string">&quot;.drag&quot;</span>).draggable(</span><br><span class="line">      &#123;</span><br><span class="line">containment: <span class="built_in">document</span>.body</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>每个<code>sampleApp</code>要有一个<code>this.num</code>,对应<code>canvas</code>的编号</p>
<ul>
<li>在调用<code>sampleApp</code>的成员函数时,除了一些关于<code>id</code>的操作,基本上不要用到<code>this.num</code></li>
<li>在创建<code>LAppLive2DManager</code>,<code>L2DTargetPoint</code>,<code>L2DViewMatrix</code>时需要用<code>this.num</code>进行区分</li>
<li>在除<code>sampleApp</code>模块外,其他的部分除了在新建对象时,基本上不需要依靠<code>this.num</code>进行区分</li>
</ul>
</li>
<li><p>原来的<code>Live2D``window</code>全局变量和<code>LAppDefine</code>使用数组进行初始化</p>
</li>
<li><p>(待定)<code>Live2DFramework</code>中只需要对<code>getPlatformManager</code>和<code>setPlatformManager</code>进行区分,但是现在关于<code>getPlatformManager</code>的作用不是特别清楚</p>
</li>
</ul>
<h2 id="8-多重tips功能"><a href="#8-多重tips功能" class="headerlink" title="8 多重tips功能"></a>8 多重tips功能</h2><p><a target="_blank" rel="noopener" href="https://imjad.cn/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-02">参考:jad</a></p>
<blockquote>
<p>需要<code>font-awesome</code>和<code>jquery</code></p>
</blockquote>
<ul>
<li>每一个<code>canvas</code>改为</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;drag_2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;drag&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">id</span>=<span class="string">&quot;tip_2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;glcanvas_2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;glcanvas&quot;</span> <span class="attr">width</span>=<span class="string">200</span> <span class="attr">height</span>=<span class="string">300</span> <span class="attr">style</span>=<span class="string">&quot;border:dashed 1px #CCC&quot;</span> <span class="attr">draggable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btnChange_2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active btnChange&quot;</span>&gt;</span>Change Model<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意<code>tip_</code>的下标是从2开始,可以使用多个<code>tip_&#123;num&#125;.json</code>,也可以只用一个</p>
</blockquote>
<ul>
<li><code>&lt;head&gt;</code>加载css和js</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;src/tips/tips.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;src/tips/tips.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意要加<code>async</code></p>
</blockquote>
<ul>
<li>修改<code>tips.css</code></li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 其他的都没用了,删掉 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tips</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">250px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">70px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">20px</span> -<span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">15px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">191</span>, <span class="number">158</span>, <span class="number">118</span>, <span class="number">0.2</span>);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">animation-delay</span>: <span class="number">5s</span>;</span><br><span class="line">  <span class="attribute">animation-duration</span>: <span class="number">50s</span>;</span><br><span class="line">  <span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">  <span class="attribute">animation-name</span>: shake;</span><br><span class="line">  <span class="attribute">animation-timing-function</span>: ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#tip_2</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">rgba</span>(<span class="number">172</span>, <span class="number">133</span>, <span class="number">253</span>, <span class="number">0.5</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">172</span>, <span class="number">133</span>, <span class="number">253</span>, <span class="number">0.62</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自己对多重canvas添加样式 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> shake &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>把<code>tips.js</code>修改为支持多重canvas</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原来的带ajax的匿名函数删掉</span></span><br><span class="line"><span class="comment">// 对鼠标事件分别执行</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.getJSON(<span class="string">&quot;tips/tips.json&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    $.each(result.mouseover, <span class="function"><span class="keyword">function</span> (<span class="params">index, tips</span>) </span>&#123;</span><br><span class="line">      $(<span class="built_in">document</span>).on(<span class="string">&quot;mouseover&quot;</span>, tips.selector, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> temp_num = <span class="built_in">Number</span>(tips.selector[tips.selector.length - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">var</span> text = tips.text;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(tips.text)) text = tips.text[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * tips.text.length + <span class="number">1</span>) - <span class="number">1</span>];</span><br><span class="line">        text = text.render(&#123;</span><br><span class="line">          text: $(<span class="built_in">this</span>).text()</span><br><span class="line">        &#125;);</span><br><span class="line">        showMessage(text, <span class="number">3000</span>, temp_num);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    $.each(result.click, <span class="function"><span class="keyword">function</span> (<span class="params">index, tips</span>) </span>&#123;</span><br><span class="line">      $(<span class="built_in">document</span>).on(<span class="string">&quot;click&quot;</span>, tips.selector, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> temp_num = <span class="built_in">Number</span>(tips.selector[tips.selector.length - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">var</span> text = tips.text;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(tips.text)) text = tips.text[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * tips.text.length + <span class="number">1</span>) - <span class="number">1</span>];</span><br><span class="line">        text = text.render(&#123;</span><br><span class="line">          text: $(<span class="built_in">this</span>).text()</span><br><span class="line">        &#125;);</span><br><span class="line">        showMessage(text, <span class="number">3000</span>, temp_num);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把一言api改成嘴臭api</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showHitokoto</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.getJSON(<span class="string">&quot;tips/fuck.json&quot;</span> <span class="comment">// 注意json格式不要写错了</span></span><br><span class="line">  , <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> randf = <span class="built_in">Math</span>.random() * <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">var</span> randi = <span class="built_in">Math</span>.floor(randf * <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">var</span> shit_len = result.fuck[<span class="number">0</span>].shit.length;</span><br><span class="line">    showMessage(result.fuck[<span class="number">0</span>].shit[randi % shit_len], <span class="number">5000</span>, randi % maxTips + minTips);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用部分就不详细写了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMessage</span>(<span class="params">text, timeout, num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(text)) text = text[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * text.length + <span class="number">1</span>) - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (num == <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (num = minTips; num &lt;= maxTips; num++) &#123;</span><br><span class="line">      $(<span class="string">&quot;#tip_&quot;</span> + num).stop();</span><br><span class="line">      $(<span class="string">&quot;#tip_&quot;</span> + num).html(text).fadeTo(<span class="number">200</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (timeout === <span class="literal">null</span>) timeout = <span class="number">5000</span>;</span><br><span class="line">      hideMessage(timeout, num);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $(<span class="string">&quot;#tip_&quot;</span> + num).stop();</span><br><span class="line">    $(<span class="string">&quot;#tip_&quot;</span> + num).html(text).fadeTo(<span class="number">200</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (timeout === <span class="literal">null</span>) timeout = <span class="number">5000</span>;</span><br><span class="line">    hideMessage(timeout, num);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hideMessage</span>(<span class="params">timeout, num</span>) </span>&#123;</span><br><span class="line">  $(<span class="string">&quot;#tip_&quot;</span> + num).stop().css(<span class="string">&#x27;opacity&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (timeout === <span class="literal">null</span>) timeout = <span class="number">5000</span>;</span><br><span class="line">  $(<span class="string">&quot;#tip_&quot;</span> + num).delay(timeout).fadeTo(<span class="number">200</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>参考<code>tips.json</code></li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mouseover&quot;</span>: [&#123;</span><br><span class="line">      <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#drag_2&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;干嘛呢你，快把手拿开&quot;</span>, <span class="string">&quot;鼠…鼠标放错地方了！&quot;</span>]</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#drag_3&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;干嘛呢你，快把手拿开&quot;</span>, <span class="string">&quot;鼠…鼠标放错地方了！&quot;</span>]</span><br><span class="line">    &#125;  ],</span><br><span class="line">  <span class="attr">&quot;click&quot;</span>: [&#123;</span><br><span class="line">    <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#drag_2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;是…是不小心碰到了吧&quot;</span>, <span class="string">&quot;萝莉控是什么呀&quot;</span>, <span class="string">&quot;你看到我的小熊了吗&quot;</span>, <span class="string">&quot;再摸的话我可要报警了！⌇●﹏●⌇&quot;</span>, <span class="string">&quot;110吗，这里有个变态一直在摸我(ó﹏ò｡)&quot;</span>]</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#drag_3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;是…是不小心碰到了吧&quot;</span>, <span class="string">&quot;萝莉控是什么呀&quot;</span>, <span class="string">&quot;你看到我的小熊了吗&quot;</span>, <span class="string">&quot;再摸的话我可要报警了！⌇●﹏●⌇&quot;</span>, <span class="string">&quot;110吗，这里有个变态一直在摸我(ó﹏ò｡)&quot;</span>]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>TODO<ul>
<li>仍有停不下来的bug</li>
</ul>
</li>
</ul>
<h2 id="9-放缩canvas大小"><a href="#9-放缩canvas大小" class="headerlink" title="9 放缩canvas大小"></a>9 放缩canvas大小</h2><p>这居然是个坑,由于官方的原因,在对<code>canvas</code>进行放缩的时候,根据<code>moc</code>文件(具体是建模过程中哪个步骤引起的不详)的不同,有的模型会实时进行比例放缩,有的不会,所以此功能暂时放弃</p>


  
<script src="/js/guide.js"></script>

  <script>
    create_guide();
  </script>
</div>

  
<script src="/js/main.js"></script>

  
<script src="/js/search.js"></script>

  
<script src="/js/highlight.js"></script>


</body>

</html>